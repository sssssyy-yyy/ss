import { AssessmentData, Question, AssessmentType } from "../types";

// 辅助函数：生成选项
const opts = (a: string, b: string, c: string, valA = 3, valB = 1, valC = 2) => [
  { id: "a", text: a, value: valA },
  { id: "b", text: b, value: valB },
  { id: "c", text: c, value: valC }
];

const QUESTION_DATABASE: Record<string, Question[]> = {
  [AssessmentType.MBTI_LITE]: [
    { id: 101, text: "在社交聚会上，你通常会？", options: opts("主动与很多人交谈，即使是不认识的人", "只与几个熟悉的朋友交谈", "视情况而定，有时活跃有时安静") },
    { id: 102, text: "当你需要做决定时，你更倾向于？", options: opts("依据逻辑、事实和数据分析", "听从内心的感受和价值观", "咨询他人的意见，折中考虑") },
    { id: 103, text: "你的工作风格更接近于？", options: opts("喜欢按计划行事，不喜欢突发状况", "喜欢灵活应对，随遇而安", "先制定大方向，细节随缘") },
    { id: 104, text: "由于对未来的设想，你经常？", options: opts("沉浸在想象中，甚至忽略了当下的细节", "更关注当下的现实和具体的细节", "在理想和现实之间努力平衡") },
    { id: 105, text: "经过一周忙碌的工作后，你更想？", options: opts("和朋友出去聚餐、唱K来放松", "独自在家看书、看电影或休息", "和家人进行简单的户外活动") },
    { id: 106, text: "在处理复杂问题时，你通常？", options: opts("把它拆解成一个个具体的步骤", "先寻找核心概念或潜在的模式", "凭借直觉和过往经验尝试解决") },
    { id: 107, text: "你认为什么样的人更让你敬佩？", options: opts("思维敏捷、逻辑严密的人", "情感丰富、富有同情心的人", "脚踏实地、执行力强的人") },
    { id: 108, text: "在这个周末，如果没有任何计划，你会？", options: opts("感到无聊，赶紧找朋友约局", "感到开心，终于可以一个人宅着了", "看心情，可能会出门逛逛") },
    { id: 109, text: "当你向别人解释一件事时，你倾向于？", options: opts("注重理论和原本的概念", "注重实际的应用和操作步骤", "用比喻和故事来表达") },
    { id: 110, text: "你更喜欢哪种类型的电影？", options: opts("烧脑悬疑或科幻片", "温馨情感或文艺片", "爆米花动作片或喜剧") },
    { id: 111, text: "在团队合作中，你最看不惯？", options: opts("逻辑混乱，没有效率", "冷漠无情，不顾他人感受", "死板教条，不懂变通") },
    { id: 112, text: "如果你的计划被突然打乱，你会？", options: opts("感到非常烦躁，急于回到正轨", "觉得无所谓，反正计划赶不上变化", "稍微调整一下，继续进行") },
    { id: 113, text: "你认为真理通常掌握在？", options: opts("客观的数据和事实手中", "人们的共识和体验中", "少数有远见的人手中") },
    { id: 114, text: "去旅游时，你习惯？", options: opts("做好详细的攻略，精确到小时", "到了目的地再说，走到哪算哪", "只定好机票酒店，大致有个方向") },
    { id: 115, text: "你更容易被什么打动？", options: opts("一个巧妙的、完美的系统设计", "一个感人的、充满人性的故事", "一个实用的、解决问题的工具") }
  ],
  [AssessmentType.BIG_FIVE]: [
    { id: 201, text: "面对新奇的艺术展或前卫的观念，你的态度是？", options: opts("非常感兴趣，渴望了解", "不太感兴趣，更喜欢传统的", "不排斥，如果有空会去看看") },
    { id: 202, text: "你的房间或办公桌通常是？", options: opts("井井有条，所有东西都在固定位置", "比较随意，甚至有些凌乱", "定期整理，平时比较随性") },
    { id: 203, text: "在团队中，你通常扮演什么角色？", options: opts("活跃气氛，带动大家说话", "安静倾听，必要时才发言", "协调者，平衡大家的意见") },
    { id: 204, text: "如果有人向你求助，你会？", options: opts("毫不犹豫地放下手头工作去帮忙", "先评估自己的时间，再决定是否帮忙", "委婉拒绝，专注于自己的事情") },
    { id: 205, text: "遇到突发压力或紧急任务时，你会？", options: opts("非常冷静，迅速制定应对方案", "感到焦虑，手心出汗", "一开始有点慌，但很快能调整过来", 3, 1, 2) },
    { id: 206, text: "你如何看待抽象的哲学讨论？", options: opts("非常着迷，喜欢深入思考", "觉得枯燥乏味，浪费时间", "偶尔听听，但不会深究") },
    { id: 207, text: "做任务时，你倾向于？", options: opts("提前完成，反复检查", "拖到最后期限才开始冲刺", "按部就班，准时完成") },
    { id: 208, text: "在一个满是陌生人的聚会上，你会？", options: opts("主动介绍自己，结交新朋友", "躲在角落玩手机或只吃东西", "等待别人来找我搭话") },
    { id: 209, text: "你认为人性本善还是本恶？", options: opts("本善，我倾向于信任他人", "本恶，我总是保持警惕", "复杂多变，视情况而定") },
    { id: 210, text: "当你的心情不好时，你会？", options: opts("很快就能自我调节恢复", "会陷入情绪低谷很长一段时间", "找人倾诉后会好转", 3, 1, 2) },
    { id: 211, text: "你喜欢尝试异国情调的食物吗？", options: opts("是的，越稀奇越好", "不，我只吃习惯的口味", "偶尔会尝鲜") },
    { id: 212, text: "你对承诺的态度是？", options: opts("一诺千金，必须做到", "尽力而为，做不到也会解释", "看情况，有时候会忘记") },
    { id: 213, text: "你觉得自己是一个？", options: opts("充满活力和热情的人", "冷静和内敛的人", "温和和平凡的人") },
    { id: 214, text: "看到别人受苦，你会？", options: opts("感同身受，非常难过", "觉得这是他们的命运，比较理性", "会同情，但不会太影响自己") },
    { id: 215, text: "面对批评，你的第一反应是？", options: opts("虚心接受，反思自己", "感到生气，想要反驳", "表面接受，心里不以为然", 3, 1, 2) }
  ],
  [AssessmentType.STRESS_LEVEL]: [
    { id: 301, text: "最近一周，你的睡眠质量如何？", options: opts("入睡困难，多梦易醒", "睡眠极佳，一觉到天亮", "偶尔失眠，总体尚可", 1, 3, 2) },
    { id: 302, text: "你是否感到容易被小事激怒？", options: opts("是的，经常因为琐事发火", "几乎不会，情绪很平稳", "偶尔会有情绪波动", 1, 3, 2) },
    { id: 303, text: "你对未来的工作或生活感到？", options: opts("充满不确定性和担忧", "充满希望和期待", "按部就班，没什么特别的感觉", 1, 3, 2) },
    { id: 304, text: "最近是否感到身体疲惫，即使休息也不缓解？", options: opts("经常感到精疲力竭", "精力充沛，身体状况良好", "工作日比较累，周末能恢复", 1, 3, 2) },
    { id: 305, text: "你是否有时间进行娱乐或放松活动？", options: opts("完全没有时间，被事情塞满了", "每天都有固定的放松时间", "偶尔有时间，但不规律", 1, 3, 2) },
    { id: 306, text: "你最近的食欲如何？", options: opts("暴饮暴食或食欲不振", "胃口很好，饮食规律", "没什么变化", 1, 3, 2) },
    { id: 307, text: "想到明天要处理的事情，你会？", options: opts("感到头疼和逃避", "充满干劲，想快点解决", "平淡面对，就是日常而已", 1, 3, 2) },
    { id: 308, text: "你最近是否出现过头痛、胃痛等不明原因的不适？", options: opts("经常出现", "从来没有", "偶尔有一点", 1, 3, 2) },
    { id: 309, text: "你觉得自己能掌控目前的生活节奏吗？", options: opts("完全失控，被生活推着走", "尽在掌握，游刃有余", "勉强维持，有点吃力", 1, 3, 2) },
    { id: 310, text: "你最近是否经常叹气？", options: opts("是的，不自觉地叹气", "没有，我很开心", "偶尔累了会叹气", 1, 3, 2) },
    { id: 311, text: "你与家人朋友的沟通频率？", options: opts("不想说话，自我封闭", "经常沟通，保持联络", "和往常一样", 1, 3, 2) },
    { id: 312, text: "在工作中，你是否感到？", options: opts("力不从心，效率低下", "得心应手，效率很高", "普普通通，完成任务", 1, 3, 2) },
    { id: 313, text: "你是否经常回忆过去或者担心未来？", options: opts("是的，很难活在当下", "不，我专注于现在", "偶尔会想一下", 1, 3, 2) },
    { id: 314, text: "遇到突发的小麻烦（如打翻水杯），你会？", options: opts("崩溃，觉得一切都很糟", "淡定清理，小事一桩", "有点烦，但能处理", 1, 3, 2) }
  ],
  [AssessmentType.EMOTIONAL_INTELLIGENCE]: [
    { id: 401, text: "当朋友向你倾诉烦恼时，你通常？", options: opts("能敏锐捕捉到对方的情绪并给予安慰", "急于给对方提供解决问题的建议", "默默倾听，不知道该说什么") },
    { id: 402, text: "当你非常愤怒时，你会？", options: opts("深呼吸，试图冷静分析原因", "立刻爆发出来，不吐不快", "压抑在心里，生闷气", 3, 1, 2) },
    { id: 403, text: "你能否轻易察觉到他人的言外之意？", options: opts("是的，我很擅长察言观色", "不太行，我比较关注字面意思", "熟悉的人可以，陌生人不行") },
    { id: 404, text: "面对失败或挫折，你的心态是？", options: opts("视为学习机会，快速调整状态", "非常沮丧，很难走出来", "需要一段时间调整，但能恢复", 3, 1, 2) },
    { id: 405, text: "在与人发生冲突时，你会？", options: opts("试图理解对方的立场，寻找共识", "据理力争，一定要赢", "为了避免尴尬，选择回避", 3, 1, 2) },
    { id: 406, text: "你如何评价自己的情绪表达？", options: opts("恰如其分，既不压抑也不失控", "经常情绪化，容易失控", "很难表达，习惯隐藏", 3, 1, 2) },
    { id: 407, text: "当团队士气低落时，你会？", options: opts("主动激励大家，传递正能量", "也感到低落，随大流", "保持沉默，做好自己的事", 3, 1, 2) },
    { id: 408, text: "你是否清楚自己当下的情绪状态？", options: opts("非常清楚，知道自己为什么高兴或生气", "经常感到莫名其妙的烦躁", "大概知道，但不深入", 3, 1, 2) },
    { id: 409, text: "面对不喜欢的人，你会？", options: opts("保持礼貌和距离，公事公办", "直接表现出厌恶，不想理会", "表面讨好，背后吐槽", 3, 1, 2) },
    { id: 410, text: "你是否善于拒绝他人的无理要求？", options: opts("温和而坚定地拒绝", "很难开口，往往勉强答应", "直接生硬地回绝", 3, 1, 2) },
    { id: 411, text: "在紧张的场合（如演讲），你能否？", options: opts("迅速调整呼吸，缓解紧张", "大脑一片空白，手足无措", "虽然紧张，但能硬着头皮完成", 3, 1, 2) },
    { id: 412, text: "看到别人成功，你会？", options: opts("真诚祝福，并以此激励自己", "感到嫉妒或失落", "觉得运气好而已", 3, 1, 2) },
    { id: 413, text: "你是否能从对方的语气或表情中读出谎言？", options: opts("经常能感觉到不对劲", "很难分辨，容易轻信", "偶尔能猜对", 3, 1, 2) }
  ]
};

// 默认备用题目
const FALLBACK_QUESTIONS: Question[] = [
  { id: 999, text: "你更喜欢哪种工作方式？", options: opts("团队合作", "独立完成", "混合模式") },
  { id: 998, text: "遇到困难时，你会？", options: opts("寻求帮助", "自己钻研", "暂时搁置") },
  { id: 997, text: "你如何看待新事物？", options: opts("积极拥抱", "谨慎观察", "看心情") }
];

export const getRandomQuestions = (topic: string, count: number = 5): AssessmentData => {
  const pool = QUESTION_DATABASE[topic] || FALLBACK_QUESTIONS;
  
  // 核心逻辑：随机打乱数组，实现“千人千面”的题目组合
  const shuffled = [...pool].sort(() => 0.5 - Math.random());
  
  // 确保不越界
  const safeCount = Math.min(count, shuffled.length);
  const selected = shuffled.slice(0, safeCount);

  return {
    title: topic,
    description: `这是关于 ${topic} 的测评问卷，包含 ${safeCount} 道精选题目。`,
    questions: selected
  };
};